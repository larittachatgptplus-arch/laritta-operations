<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Laritta Operations System</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase v9 Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    }
    
    #loading-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
    }
    
    #loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .loader {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="loader"></div>
    <p style="color: white; font-size: 18px; font-weight: bold; margin-top: 20px;">Loading Laritta Operations...</p>
  </div>
  
  <!-- React Root -->
  <div id="root"></div>
  
  <!-- Initialize Firebase -->
  <script>
    // ‚úÖ CONFIG FIREBASE YANG BENAR dari Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyD66JBknPCHDzJ4NcLq3ql7T867TJpTbSY",
      authDomain: "laritta-operations-system.firebaseapp.com",
      projectId: "laritta-operations-system",
      storageBucket: "laritta-operations-system.firebasestorage.app",
      messagingSenderId: "660263238018",
      appId: "1:660263238018:web:836be901d1451122867f9b",
      measurementId: "G-VLT1M85TD5"
    };
    
    // Initialize Firebase
    try {
      firebase.initializeApp(firebaseConfig);
      console.log('‚úÖ Firebase initialized successfully!');
      console.log('Project ID:', firebaseConfig.projectId);
    } catch (error) {
      console.error('‚ùå Firebase initialization error:', error);
    }
    
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // Hide loading screen
    setTimeout(() => {
      document.getElementById('loading-screen').classList.add('hidden');
    }, 2500);
  </script>
  
  <!-- Main React Application -->
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    // App ID
    const appId = "laritta-ops-v2";
    
    // 41 OUTLET LENGKAP
    const OUTLETS = [
      { code: 'SBY-001', name: 'Barata', area: 'Surabaya' },
      { code: 'SBY-002', name: 'Candi', area: 'Sidoarjo' },
      { code: 'SBY-003', name: 'Cemengkalang', area: 'Surabaya' },
      { code: 'SBY-004', name: 'Darmahusada', area: 'Surabaya' },
      { code: 'SBY-005', name: 'Darmo Permai', area: 'Surabaya' },
      { code: 'SBY-006', name: 'Deltasari', area: 'Sidoarjo' },
      { code: 'SBY-007', name: 'Demak', area: 'Surabaya' },
      { code: 'SBY-008', name: 'Diponegoro', area: 'Sidoarjo' },
      { code: 'SBY-009', name: 'Dukuh Kupang', area: 'Surabaya' },
      { code: 'SBY-010', name: 'Gayung Sari', area: 'Surabaya' },
      { code: 'SBY-011', name: 'Gresik Kota Baru', area: 'Gresik' },
      { code: 'SBY-012', name: 'Iskandar Muda', area: 'Surabaya' },
      { code: 'SBY-013', name: 'Kapas Krampung', area: 'Surabaya' },
      { code: 'SBY-014', name: 'Kedung Cowek', area: 'Surabaya' },
      { code: 'SBY-015', name: 'Ketintang', area: 'Surabaya' },
      { code: 'SBY-016', name: 'Krian', area: 'Sidoarjo' },
      { code: 'SBY-017', name: 'Kutai', area: 'Surabaya' },
      { code: 'SBY-018', name: 'Manukan', area: 'Surabaya' },
      { code: 'SBY-019', name: 'Menganti', area: 'Gresik' },
      { code: 'SBY-020', name: 'Mulyosari', area: 'Surabaya' },
      { code: 'SBY-021', name: 'Nias', area: 'Surabaya' },
      { code: 'SBY-022', name: 'Perak', area: 'Surabaya' },
      { code: 'SBY-023', name: 'Rungkut', area: 'Surabaya' },
      { code: 'SBY-024', name: 'Rungkut Tengah', area: 'Surabaya' },
      { code: 'SBY-025', name: 'Sepanjang', area: 'Sidoarjo' },
      { code: 'SBY-026', name: 'ST. Gubeng', area: 'Surabaya' },
      { code: 'SBY-027', name: 'Sukodono', area: 'Sidoarjo' },
      { code: 'SBY-028', name: 'Tanggulangin', area: 'Sidoarjo' },
      { code: 'SBY-029', name: 'Tropodo', area: 'Sidoarjo' },
      { code: 'SBY-030', name: 'Wage', area: 'Surabaya' },
      { code: 'SBY-031', name: 'Wiyung', area: 'Surabaya' },
      { code: 'SBY-032', name: 'Bangkalan', area: 'Surabaya' },
      { code: 'SBY-033', name: 'Panglima Sudirman', area: 'Surabaya' },
      { code: 'TGR-001', name: 'Borobudur', area: 'Tangerang' },
      { code: 'TGR-002', name: 'Ciledug', area: 'Tangerang' },
      { code: 'TGR-003', name: 'Halim', area: 'Tangerang' },
      { code: 'TGR-004', name: 'Merdeka', area: 'Tangerang' },
      { code: 'TGR-005', name: 'Periuk', area: 'Tangerang' },
      { code: 'TGR-006', name: 'Poris', area: 'Tangerang' },
      { code: 'TGR-007', name: 'Raden Saleh', area: 'Tangerang' },
      { code: 'TGR-008', name: 'Graha Raya', area: 'Tangerang' }
    ];
    
    // 8 DEPARTEMEN
    const DEPARTMENTS = [
      'HRD',
      'Procurement',
      'Logistik',
      'Produksi',
      'R&D',
      'Auditor',
      'Sales Mobile',
      'Sales Online'
    ];
    
    const REQUEST_TYPES = [
      { id: 'cetak', label: 'Cetak Banner/Menu', icon: 'üñ®Ô∏è' },
      { id: 'speaker', label: 'Speaker/Sound', icon: 'üì¢' },
      { id: 'event_offline', label: 'Event Offline', icon: 'üìÖ' },
      { id: 'digital', label: 'Konten Digital', icon: 'üì±' },
    ];
    
    const PRIORITY_CONFIG = {
      high: { label: 'Tinggi', color: 'bg-red-100 text-red-700 border-red-200' },
      medium: { label: 'Sedang', color: 'bg-yellow-100 text-yellow-700 border-yellow-200' },
      low: { label: 'Rendah', color: 'bg-green-100 text-green-700 border-green-200' }
    };
    
    // Main App
    function App() {
      const [user, setUser] = useState(null);
      const [authReady, setAuthReady] = useState(false);
      const [viewMode, setViewMode] = useState('cabang');
      const [requests, setRequests] = useState([]);
      const [loading, setLoading] = useState(true);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [submitting, setSubmitting] = useState(false);
      
      const [activeTab, setActiveTab] = useState('all');
      const [selectedBranchFilter, setSelectedBranchFilter] = useState('all');
      const [categoryFilter, setCategoryFilter] = useState('all');
      
      const [newReq, setNewReq] = useState({
        type: 'cetak',
        title: '',
        description: '',
        deadline: '',
        requesterName: '',
        requesterCategory: 'outlet',
        outlet: OUTLETS[0].code,
        department: DEPARTMENTS[0],
        customDepartment: '',
        priority: 'medium'
      });
      
      // Auth - dengan error handling lebih baik
      useEffect(() => {
        console.log('üîê Starting authentication...');
        
        const unsubscribe = auth.onAuthStateChanged((currentUser) => {
          console.log('üë§ Auth state changed:', currentUser ? 'User logged in' : 'No user');
          setUser(currentUser);
          setAuthReady(true);
          
          if (!currentUser) {
            console.log('üîÑ Signing in anonymously...');
            auth.signInAnonymously()
              .then(() => console.log('‚úÖ Anonymous sign-in successful'))
              .catch(error => {
                console.error('‚ùå Anonymous sign-in error:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
              });
          }
        });
        
        return () => unsubscribe();
      }, []);
      
      // Data Fetching - hanya jalan kalau user sudah ready
      useEffect(() => {
        if (!authReady) {
          console.log('‚è≥ Waiting for auth to be ready...');
          return;
        }
        
        if (!user) {
          console.log('‚è≥ Waiting for user...');
          return;
        }
        
        console.log('üìä Starting to fetch data...');
        console.log('Collection path: artifacts/' + appId + '/public/data/requests');
        
        const unsubscribe = db
          .collection('artifacts')
          .doc(appId)
          .collection('public')
          .doc('data')
          .collection('requests')
          .orderBy('createdAt', 'desc')
          .onSnapshot((snapshot) => {
            console.log('‚úÖ Data snapshot received:', snapshot.size, 'documents');
            const data = snapshot.docs.map(doc => {
              const docData = doc.data();
              console.log('Document:', doc.id, docData);
              return {
                id: doc.id,
                ...docData
              };
            });
            setRequests(data);
            setLoading(false);
          }, (error) => {
            console.error("‚ùå Firestore snapshot error:", error);
            console.error("Error code:", error.code);
            console.error("Error message:", error.message);
            setLoading(false);
          });
        
        return () => unsubscribe();
      }, [user, authReady]);
      
      // Submit Request
      const handleSubmitRequest = async (e) => {
        e.preventDefault();
        
        console.log('üì§ Submit button clicked');
        console.log('Auth ready:', authReady);
        console.log('User:', user ? 'Logged in' : 'Not logged in');
        
        if (!user) {
          console.error('‚ùå No user - cannot submit');
          alert('‚ùå Belum login. Tunggu beberapa detik dan coba lagi.');
          return;
        }
        
        setSubmitting(true);
        console.log('üìù Preparing request data...');
        
        try {
          // Tentukan branch
          let branchInfo = '';
          if (newReq.requesterCategory === 'outlet') {
            const outlet = OUTLETS.find(o => o.code === newReq.outlet);
            branchInfo = `${outlet.code} - ${outlet.name} (${outlet.area})`;
          } else {
            branchInfo = newReq.customDepartment.trim() || newReq.department;
          }
          
          const requestData = {
            type: newReq.type,
            title: newReq.title,
            description: newReq.description,
            deadline: newReq.deadline,
            status: 'pending',
            branch: branchInfo,
            requesterName: newReq.requesterName,
            requesterCategory: newReq.requesterCategory,
            priority: newReq.priority,
            comments: [],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          console.log('üìã Request data:', requestData);
          console.log('üî• Submitting to Firestore...');
          
          const docRef = await db
            .collection('artifacts')
            .doc(appId)
            .collection('public')
            .doc('data')
            .collection('requests')
            .add(requestData);
          
          console.log('‚úÖ Request submitted! Doc ID:', docRef.id);
          
          setIsModalOpen(false);
          setNewReq({
            type: 'cetak',
            title: '',
            description: '',
            deadline: '',
            requesterName: newReq.requesterName,
            requesterCategory: 'outlet',
            outlet: OUTLETS[0].code,
            department: DEPARTMENTS[0],
            customDepartment: '',
            priority: 'medium'
          });
          
          alert('‚úÖ Request berhasil dibuat!');
        } catch (error) {
          console.error("‚ùå Error submitting request:", error);
          console.error("Error code:", error.code);
          console.error("Error message:", error.message);
          console.error("Error stack:", error.stack);
          alert(`‚ùå Gagal membuat request: ${error.message}`);
        } finally {
          setSubmitting(false);
        }
      };
      
      // Update Status
      const updateStatus = async (id, newStatus) => {
        if (!user) return;
        console.log(`üîÑ Updating ${id} to ${newStatus}`);
        
        try {
          await db
            .collection('artifacts')
            .doc(appId)
            .collection('public')
            .doc('data')
            .collection('requests')
            .doc(id)
            .update({ 
              status: newStatus,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          console.log('‚úÖ Status updated');
        } catch (error) {
          console.error("‚ùå Update error:", error);
          alert('Gagal update status');
        }
      };
      
      // Filtering
      const filteredRequests = useMemo(() => {
        let data = requests;
        
        if (categoryFilter === 'outlet') {
          data = data.filter(r => r.requesterCategory === 'outlet');
        } else if (categoryFilter === 'departemen') {
          data = data.filter(r => r.requesterCategory === 'departemen');
        }
        
        if (selectedBranchFilter !== 'all') {
          data = data.filter(r => r.branch && r.branch.includes(selectedBranchFilter));
        }
        
        if (activeTab !== 'all') {
          data = data.filter(r => r.status === activeTab);
        }
        
        return data;
      }, [requests, selectedBranchFilter, activeTab, categoryFilter]);
      
      const stats = useMemo(() => {
        let baseData = requests;
        if (selectedBranchFilter !== 'all') {
          baseData = baseData.filter(r => r.branch && r.branch.includes(selectedBranchFilter));
        }
        
        return {
          total: baseData.length,
          pending: baseData.filter(r => r.status === 'pending').length,
          process: baseData.filter(r => r.status === 'process').length,
          done: baseData.filter(r => r.status === 'done').length
        };
      }, [requests, selectedBranchFilter]);
      
      // Show auth status
      if (!authReady) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 to-orange-50">
            <div className="text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-4 border-orange-500 border-t-transparent mx-auto mb-4"></div>
              <p className="text-lg font-bold text-slate-700">Menghubungkan ke Firebase...</p>
              <p className="text-sm text-slate-500 mt-2">Tunggu sebentar...</p>
            </div>
          </div>
        );
      }
      
      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-orange-50/30 to-slate-50">
          
          {/* Navbar */}
          <header className="bg-white shadow-sm sticky top-0 z-20 border-b">
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                <div className="flex items-center gap-3">
                  <div className="bg-gradient-to-br from-orange-500 to-orange-600 p-3 rounded-xl text-white shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="3" y1="9" x2="21" y2="9"></line>
                      <line x1="9" y1="21" x2="9" y2="9"></line>
                    </svg>
                  </div>
                  <div>
                    <h1 className="text-xl font-bold text-slate-900">Laritta Operations</h1>
                    <p className="text-xs text-slate-500">Marketing Request System - 41 Outlet & 8 Dept</p>
                  </div>
                </div>
                
                <div className="flex gap-2 bg-slate-100 p-1 rounded-xl">
                  <button
                    onClick={() => setViewMode('cabang')}
                    className={`px-4 py-2 rounded-lg text-sm font-bold transition ${
                      viewMode === 'cabang' 
                        ? 'bg-white text-orange-700 shadow' 
                        : 'text-slate-500'
                    }`}
                  >
                    üè™ Mode Outlet/Dept
                  </button>
                  <button
                    onClick={() => setViewMode('marketing_pusat')}
                    className={`px-4 py-2 rounded-lg text-sm font-bold transition ${
                      viewMode === 'marketing_pusat' 
                        ? 'bg-white text-blue-700 shadow' 
                        : 'text-slate-500'
                    }`}
                  >
                    üéØ Mode Marketing
                  </button>
                </div>
              </div>
            </div>
          </header>
          
          {/* Main Content */}
          <main className="max-w-7xl mx-auto px-4 py-6">
            
            {/* Banner */}
            <div className={`mb-6 p-5 rounded-2xl border-2 ${
              viewMode === 'marketing_pusat' 
                ? 'bg-blue-50 border-blue-200' 
                : 'bg-orange-50 border-orange-200'
            }`}>
              <h3 className="font-bold text-base mb-1">
                {viewMode === 'marketing_pusat' ? 'üéØ Mode Marketing Pusat' : 'üè™ Mode Outlet / Departemen'}
              </h3>
              <p className="text-sm">
                {viewMode === 'marketing_pusat' 
                  ? 'Kelola semua request dari 41 outlet & 8 departemen' 
                  : 'Buat request untuk kebutuhan operasional'}
              </p>
              {user && <p className="text-xs text-slate-500 mt-2">‚úÖ Terhubung & siap digunakan</p>}
            </div>
            
            {/* Stats */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              <div className="bg-white p-5 rounded-xl shadow-sm border">
                <div className="text-slate-500 text-xs font-bold uppercase mb-2">Total</div>
                <div className="text-3xl font-bold text-slate-900">{stats.total}</div>
              </div>
              <div className="bg-yellow-50 p-5 rounded-xl border-2 border-yellow-200">
                <div className="text-yellow-700 text-xs font-bold uppercase mb-2">Menunggu</div>
                <div className="text-3xl font-bold text-yellow-800">{stats.pending}</div>
              </div>
              <div className="bg-blue-50 p-5 rounded-xl border-2 border-blue-200">
                <div className="text-blue-700 text-xs font-bold uppercase mb-2">Diproses</div>
                <div className="text-3xl font-bold text-blue-800">{stats.process}</div>
              </div>
              <div className="bg-green-50 p-5 rounded-xl border-2 border-green-200">
                <div className="text-green-700 text-xs font-bold uppercase mb-2">Selesai</div>
                <div className="text-3xl font-bold text-green-800">{stats.done}</div>
              </div>
            </div>
            
            {/* Filters & Action */}
            <div className="flex flex-col md:flex-row justify-between gap-4 mb-6 flex-wrap">
              <div className="flex gap-3 flex-wrap">
                <select
                  className="p-3 border-2 rounded-xl bg-white font-medium text-sm"
                  value={categoryFilter}
                  onChange={(e) => setCategoryFilter(e.target.value)}
                >
                  <option value="all">üîç Semua Kategori</option>
                  <option value="outlet">üè™ Outlet Saja</option>
                  <option value="departemen">üè¢ Departemen Saja</option>
                </select>
                
                <select
                  className="p-3 border-2 rounded-xl bg-white font-medium text-sm"
                  value={selectedBranchFilter}
                  onChange={(e) => setSelectedBranchFilter(e.target.value)}
                >
                  <option value="all">üìç Semua Lokasi</option>
                  <optgroup label="üè™ OUTLET">
                    {OUTLETS.map(o => (
                      <option key={o.code} value={o.code}>
                        {o.code} - {o.name}
                      </option>
                    ))}
                  </optgroup>
                  <optgroup label="üè¢ DEPARTEMEN">
                    {DEPARTMENTS.map(d => (
                      <option key={d} value={d}>{d}</option>
                    ))}
                  </optgroup>
                </select>
                
                <div className="flex bg-white rounded-xl p-1 border-2">
                  {[
                    { id: 'all', label: 'Semua' },
                    { id: 'pending', label: 'Menunggu' },
                    { id: 'process', label: 'Diproses' },
                    { id: 'done', label: 'Selesai' }
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`px-3 py-2 rounded-lg text-xs font-bold whitespace-nowrap ${
                        activeTab === tab.id 
                          ? 'bg-slate-900 text-white' 
                          : 'text-slate-600'
                      }`}
                    >
                      {tab.label}
                    </button>
                  ))}
                </div>
              </div>
              
              {viewMode === 'cabang' && (
                <button
                  onClick={() => setIsModalOpen(true)}
                  disabled={!user}
                  className="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-xl font-bold whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  ‚ûï Buat Request Baru
                </button>
              )}
            </div>
            
            {/* Request Grid */}
            {loading ? (
              <div className="text-center py-20">
                <div className="animate-spin rounded-full h-12 w-12 border-4 border-orange-500 border-t-transparent mx-auto mb-4"></div>
                <p className="font-medium text-slate-600">Memuat data dari Firebase...</p>
              </div>
            ) : filteredRequests.length === 0 ? (
              <div className="text-center py-20 bg-white rounded-2xl border-2 border-dashed">
                <div className="text-6xl mb-4">üìã</div>
                <h3 className="text-xl font-bold text-slate-900 mb-2">Belum ada permintaan</h3>
                <p className="text-slate-500">Klik "Buat Request Baru" untuk memulai</p>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredRequests.map(req => (
                  <div key={req.id} className="bg-white rounded-xl border shadow-sm p-5 relative">
                    <div className={`absolute top-0 left-0 w-full h-1 rounded-t-xl ${
                      req.status === 'done' ? 'bg-green-500' : 
                      req.status === 'process' ? 'bg-blue-500' : 'bg-yellow-500'
                    }`}></div>
                    
                    <div className="flex justify-between items-start mb-3 pt-2">
                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                        req.status === 'done' ? 'bg-green-100 text-green-700' :
                        req.status === 'process' ? 'bg-blue-100 text-blue-700' :
                        'bg-yellow-100 text-yellow-700'
                      }`}>
                        {req.status === 'done' ? '‚úÖ Selesai' :
                         req.status === 'process' ? '‚öôÔ∏è Diproses' : '‚è≥ Menunggu'}
                      </span>
                      {req.priority && (
                        <span className={`px-2 py-1 rounded-full text-xs font-bold ${PRIORITY_CONFIG[req.priority].color}`}>
                          {PRIORITY_CONFIG[req.priority].label}
                        </span>
                      )}
                    </div>
                    
                    <div className="mb-2">
                      <span className={`text-xs px-2 py-1 rounded ${
                        req.requesterCategory === 'outlet' 
                          ? 'bg-blue-100 text-blue-700' 
                          : 'bg-purple-100 text-purple-700'
                      }`}>
                        {req.requesterCategory === 'outlet' ? 'üè™ Outlet' : 'üè¢ Departemen'}
                      </span>
                    </div>
                    
                    <h3 className="font-bold text-lg text-slate-800 mb-2">{req.title}</h3>
                    <p className="text-sm text-slate-600 mb-4 bg-slate-50 p-3 rounded-lg line-clamp-3">
                      {req.description}
                    </p>
                    
                    <div className="space-y-2 text-xs text-slate-600 mb-3">
                      <div className="flex items-center gap-2">
                        <span>üë§</span>
                        <span className="font-medium">{req.requesterName}</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <span>üìç</span>
                        <span>{req.branch}</span>
                      </div>
                    </div>
                    
                    {req.deadline && (
                      <div className="text-xs text-slate-600 bg-slate-100 p-2 rounded mb-3">
                        üìÖ Target: {new Date(req.deadline).toLocaleDateString('id-ID')}
                      </div>
                    )}
                    
                    {viewMode === 'marketing_pusat' && (
                      <div className="grid grid-cols-2 gap-2 pt-3 border-t">
                        {req.status === 'pending' && (
                          <>
                            <button 
                              onClick={() => updateStatus(req.id, 'process')}
                              className="bg-blue-600 text-white py-2 rounded font-bold text-sm hover:bg-blue-700"
                            >
                              Proses
                            </button>
                            <button 
                              onClick={() => updateStatus(req.id, 'rejected')}
                              className="border-2 text-slate-700 py-2 rounded font-bold text-sm hover:bg-red-50"
                            >
                              Tolak
                            </button>
                          </>
                        )}
                        {req.status === 'process' && (
                          <button 
                            onClick={() => updateStatus(req.id, 'done')}
                            className="col-span-2 bg-green-600 text-white py-2 rounded font-bold text-sm hover:bg-green-700"
                          >
                            ‚úÖ Selesai
                          </button>
                        )}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </main>
          
          {/* Create Modal - FORM LENGKAP */}
          {isModalOpen && (
            <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 overflow-y-auto">
              <div className="bg-white rounded-2xl max-w-2xl w-full my-8">
                <div className="p-6 border-b bg-orange-50 rounded-t-2xl flex justify-between items-center sticky top-0">
                  <div>
                    <h2 className="text-xl font-bold">üìù Formulir Request Baru</h2>
                    <p className="text-sm text-slate-600">Pastikan semua data terisi dengan benar</p>
                  </div>
                  <button 
                    onClick={() => setIsModalOpen(false)}
                    className="text-slate-600 hover:text-slate-900 text-2xl font-bold"
                  >
                    ‚úï
                  </button>
                </div>
                
                <form onSubmit={handleSubmitRequest} className="p-6 space-y-5 max-h-[70vh] overflow-y-auto">
                  
                  {/* Nama Pemohon */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Nama Pemohon *
                    </label>
                    <input 
                      type="text" 
                      required
                      placeholder="Masukkan nama lengkap"
                      className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                      value={newReq.requesterName}
                      onChange={(e) => setNewReq({...newReq, requesterName: e.target.value})}
                    />
                  </div>
                  
                  {/* Kategori */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Pemohon Dari *
                    </label>
                    <div className="grid grid-cols-2 gap-3">
                      <button
                        type="button"
                        onClick={() => setNewReq({...newReq, requesterCategory: 'outlet'})}
                        className={`p-4 rounded-xl border-2 text-sm font-bold transition ${
                          newReq.requesterCategory === 'outlet' 
                            ? 'border-blue-500 bg-blue-50 text-blue-700' 
                            : 'border-slate-200 hover:border-slate-300'
                        }`}
                      >
                        üè™ Outlet/Toko
                      </button>
                      <button
                        type="button"
                        onClick={() => setNewReq({...newReq, requesterCategory: 'departemen'})}
                        className={`p-4 rounded-xl border-2 text-sm font-bold transition ${
                          newReq.requesterCategory === 'departemen' 
                            ? 'border-purple-500 bg-purple-50 text-purple-700' 
                            : 'border-slate-200 hover:border-slate-300'
                        }`}
                      >
                        üè¢ Departemen
                      </button>
                    </div>
                  </div>
                  
                  {/* Pilih Outlet/Departemen */}
                  {newReq.requesterCategory === 'outlet' ? (
                    <div>
                      <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                        Pilih Outlet *
                      </label>
                      <select 
                        required
                        className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                        value={newReq.outlet}
                        onChange={(e) => setNewReq({...newReq, outlet: e.target.value})}
                      >
                        {OUTLETS.map(o => (
                          <option key={o.code} value={o.code}>
                            {o.code} - {o.name} ({o.area})
                          </option>
                        ))}
                      </select>
                    </div>
                  ) : (
                    <div>
                      <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                        Pilih Departemen *
                      </label>
                      <select 
                        className="w-full p-3 border-2 rounded-xl mb-3 focus:border-orange-500 focus:outline-none"
                        value={newReq.department}
                        onChange={(e) => setNewReq({...newReq, department: e.target.value, customDepartment: ''})}
                      >
                        {DEPARTMENTS.map(d => (
                          <option key={d} value={d}>{d}</option>
                        ))}
                      </select>
                      <label className="block text-xs font-bold text-slate-500 mb-2">
                        Atau Input Manual:
                      </label>
                      <input 
                        type="text" 
                        placeholder="Departemen lain..."
                        className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                        value={newReq.customDepartment}
                        onChange={(e) => setNewReq({...newReq, customDepartment: e.target.value})}
                      />
                    </div>
                  )}
                  
                  {/* Jenis Request */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Jenis Permintaan *
                    </label>
                    <div className="grid grid-cols-2 gap-3">
                      {REQUEST_TYPES.map(type => (
                        <button
                          type="button"
                          key={type.id}
                          onClick={() => setNewReq({...newReq, type: type.id})}
                          className={`p-3 rounded-xl border-2 text-sm font-medium transition ${
                            newReq.type === type.id 
                              ? 'border-orange-500 bg-orange-50 text-orange-700' 
                              : 'border-slate-200 hover:border-slate-300'
                          }`}
                        >
                          {type.icon} {type.label}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  {/* Prioritas */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Prioritas *
                    </label>
                    <div className="grid grid-cols-3 gap-3">
                      {['low', 'medium', 'high'].map(priority => (
                        <button
                          type="button"
                          key={priority}
                          onClick={() => setNewReq({...newReq, priority})}
                          className={`p-3 rounded-xl border-2 text-sm font-bold transition ${
                            newReq.priority === priority 
                              ? 'border-orange-500 bg-orange-50 text-orange-700' 
                              : 'border-slate-200 hover:border-slate-300'
                          }`}
                        >
                          {PRIORITY_CONFIG[priority].label}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  {/* Judul */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Judul Permintaan *
                    </label>
                    <input
                      type="text"
                      required
                      placeholder="Contoh: Banner Promo Tahun Baru"
                      className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                      value={newReq.title}
                      onChange={e => setNewReq({...newReq, title: e.target.value})}
                    />
                  </div>
                  
                  {/* Deskripsi */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Deskripsi Detail *
                    </label>
                    <textarea
                      required
                      rows={4}
                      placeholder="Jelaskan detail seperti ukuran, jumlah, spesifikasi teknis, warna, deadline internal, dll..."
                      className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                      value={newReq.description}
                      onChange={e => setNewReq({...newReq, description: e.target.value})}
                    />
                  </div>
                  
                  {/* Deadline */}
                  <div>
                    <label className="block text-xs font-bold text-slate-600 uppercase mb-2">
                      Deadline *
                    </label>
                    <input
                      type="date"
                      required
                      min={new Date().toISOString().split('T')[0]}
                      className="w-full p-3 border-2 rounded-xl focus:border-orange-500 focus:outline-none"
                      value={newReq.deadline}
                      onChange={e => setNewReq({...newReq, deadline: e.target.value})}
                    />
                  </div>
                  
                  {/* Buttons */}
                  <div className="flex gap-3 pt-4 border-t sticky bottom-0 bg-white">
                    <button
                      type="button"
                      onClick={() => setIsModalOpen(false)}
                      disabled={submitting}
                      className="flex-1 py-3 border-2 border-slate-300 rounded-xl font-bold hover:bg-slate-50 disabled:opacity-50"
                    >
                      Batal
                    </button>
                    <button
                      type="submit"
                      disabled={submitting || !user}
                      className="flex-1 py-3 bg-orange-600 text-white rounded-xl font-bold hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      {submitting ? '‚è≥ Mengirim...' : '‚úÖ Kirim Request'}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }
    
    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
  
</body>
</html>
